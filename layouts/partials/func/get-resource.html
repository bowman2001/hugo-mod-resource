{{- $name := "hugo-mod-resource â€“ partial get-resource" }}

{{- /* Initialize local variables with the values from the context map */}}
{{- $ctx := .ctx }}
{{- $src := .src }}
{{- $errorLevel := .errorLevel }}

{{- $u := urls.Parse $src }}
{{- $errorMsg := printf "Unable to resolve the resource %q" $u.String }}

{{- $r := "" }}
{{- if $u.IsAbs }} {{- /* Remote */}}
    {{- with resources.GetRemote $u.String }}
        {{- with .Err }}
            {{ $msg := print $errorMsg ". " . }}
            {{- partial "md-error-msg" (dict "caller" $name "ctx" $ctx "errorMsg" $msg "errorLevel" $errorLevel )}}
        {{- else }}
            {{- $r = . }}
        {{ end }}
    {{- else }}
        {{- partial "md-error-msg" (dict "caller" $name "ctx" $ctx "errorMsg" $errorMsg "errorLevel" $errorLevel) }}
    {{- end }}
{{- else }}
    {{- with $ctx.Page.Resources.GetMatch (strings.TrimPrefix "./" $u.Path) }} {{- /* Page */}}
        {{- $r = . }}
    {{- else }}
        {{- /* Fallback: Search in associated pages */}}
    {{- end }}    
    {{- if not $r }}
        {{- with resources.Get $u.Path }} {{- /* Site */}}
            {{- $r = . }}
        {{- else }}
        {{- partial "md-error-msg" (dict "caller" $name "ctx" $ctx "errorMsg" $errorMsg "errorLevel" $errorLevel) }}
        {{- end }}   
    {{- end }}
{{- end }}

{{- return $r }}